var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);i.prototype=e.prototype,t.prototype=new i},GameObject=function(){function t(){this.shape=null,t.objects.push(this)}return t.prototype.destroy=function(){this.deleteFlag=!0},t.prototype.onDestroy=function(){},t.initial=function(e){t.display=e},t.process=function(){t.objects.forEach(function(t){return t.update()}),t.objects=t.objects.filter(function(t){return t.deleteFlag&&t["delete"](),!t.deleteFlag}),t.transit&&(t.dispose(),t.transit(),t.transit=null)},t.dispose=function(){t.objects=t.objects.filter(function(t){return t.destroy(),t["delete"](),!1})},t.prototype["delete"]=function(){this.onDestroy(),this.shape&&(t.display.removeChild(this.shape),this.shape=null)},t.objects=[],t}();__reflect(GameObject.prototype,"GameObject");var Ball=function(t){function e(i,a,s,h){var o=t.call(this)||this;return e.balls.push(o),o.radius=BALL_SIZE_PER_WIDTH*Util.width*.5,o.setShape(i,a,o.radius),o.vx=s,o.vy=h,o}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;e.balls=e.balls.filter(function(e){return e!=t})},e.prototype.setShape=function(t,e,i){this.shape&&GameObject.display.removeChild(this.shape),this.shape=new egret.Shape,this.shape.graphics.beginFill(16760832),this.shape.graphics.drawCircle(0,0,i),this.shape.graphics.endFill(),GameObject.display.addChild(this.shape),this.shape.x=t,this.shape.y=e},e.prototype.update=function(){var t=this;this.shape.x+=this.vx,this.shape.y+=this.vy;var e=null,i=0;if(Box.boxes.forEach(function(a){var s=a.shape.x-t.shape.x,h=a.shape.y-t.shape.y,o=Math.pow(s,2),n=Math.pow(h,2);if(e)i>o+n&&(e=a,i=o+n);else{var r=.5*a.sizeW+t.radius,p=.5*a.sizeH+t.radius;o<Math.pow(r,2)&&n<Math.pow(p,2)&&(e=a,i=o+n)}}),e){var a=e.shape.x-this.shape.x,s=e.shape.y-this.shape.y;Math.abs(s/a)>=Box.sizeRateH?this.vy*=-1:this.vx*=-1,e.applyDamage(1)}this.boundWall()},e.prototype.boundWall=function(){Math.pow(this.shape.x-.5*Util.width,2)>Math.pow(.5*Util.width-this.radius,2)&&(this.vx*=-1,this.vy+=.05*this.radius,this.shape.x+=this.vx),this.vy<0&&this.shape.y<this.radius&&(this.vy*=-1,this.shape.y+=this.vy),this.shape.y>Util.height&&this.destroy()},e.balls=[],e}(GameObject);__reflect(Ball.prototype,"Ball");var GameOver=function(t){function e(){var e=t.call(this)||this;return e.textGameOver=null,e.textScore=null,e.textGameOver=Util.newTextField("GAME OVER",Util.width/10,16777215,.5,.45,!0),GameObject.display.addChild(e.textGameOver),e.textScore=Util.newTextField("SCORE : "+Score.I.point.toFixed(),Util.width/12,16777215,.5,.55,!0),GameObject.display.addChild(e.textScore),GameObject.display.once(egret.TouchEvent.TOUCH_TAP,function(t){return e.tap(t)},e),e}return __extends(e,t),e.prototype.onDestroy=function(){GameObject.display.removeChild(this.textGameOver),this.textGameOver=null,GameObject.display.removeChild(this.textScore),this.textScore=null},e.prototype.update=function(){},e.prototype.tap=function(t){GameObject.transit=Game.loadSceneGamePlay,this.destroy()},e}(GameObject);__reflect(GameOver.prototype,"GameOver");var Box=function(t){function e(i,a,s){var h=t.call(this)||this;return e.boxes.push(h),h.sizeW=Util.width*BOX_SIZE_PER_WIDTH*.95,h.sizeH=h.sizeW*e.sizeRateH,h.hp=s,h.setShape(i,a),h}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;e.boxes=e.boxes.filter(function(e){return e!=t})},e.prototype.setShape=function(t,i){this.shape&&GameObject.display.removeChild(this.shape),this.shape=new egret.Shape,this.shape.graphics.beginFill(e.getColor(this.hp)),this.shape.graphics.drawRect(-.5*this.sizeW,-.5*this.sizeH,this.sizeW,this.sizeH),this.shape.graphics.endFill(),GameObject.display.addChild(this.shape),GameObject.display.setChildIndex(this.shape,2),this.shape.x=t,this.shape.y=i},e.getColor=function(t){var i=Util.clamp((t-1)/(e.maxHp-1),0,1);return Util.colorLerp(15781888,8388608,i)},e.prototype.update=function(){},e.prototype.applyDamage=function(t){if(void 0===t&&(t=1),this.hp-=t,this.hp>0)this.setShape(this.shape.x,this.shape.y);else{if(0==Util.randomInt(0,4)){var e=[ItemType.Ball,ItemType.Ball,ItemType.Ball,ItemType.Ball,ItemType.Big,ItemType.Way5];new Item(this.shape.x,this.shape.y,e[Util.randomInt(0,e.length-1)])}Score.I.breakBox(),this.destroy()}},e.boxes=[],e.sizeRateH=.75,e.maxHp=15,e}(GameObject);__reflect(Box.prototype,"Box");var BOXES_IN_WIDTH=6,BOX_SIZE_PER_WIDTH=1/BOXES_IN_WIDTH,PADDLE_SIZE_PER_WIDTH=.25,BALL_SIZE_PER_WIDTH=PADDLE_SIZE_PER_WIDTH/4,Game=function(){function t(){}return t.loadSceneGamePlay=function(){new Background,new Paddle,new Score},t}();__reflect(Game.prototype,"Game");var Background=function(t){function e(){var e=t.call(this)||this;return e.shape=new egret.Shape,e.shape.graphics.beginFill(49376),e.shape.graphics.drawRect(0,0,Util.width,Util.height),e.shape.graphics.endFill(),GameObject.display.addChild(e.shape),e}return __extends(e,t),e.prototype.update=function(){},e}(GameObject);__reflect(Background.prototype,"Background");var BigBall=function(t){function e(e,i,a,s){var h=t.call(this,e,i,a,s)||this;return h.hp=40,h.radius=BALL_SIZE_PER_WIDTH*Util.width*.5*2,h.setShape(e,i,h.radius),h}return __extends(e,t),e.prototype.update=function(){var t=this;this.shape.x+=this.vx,this.shape.y+=this.vy,Box.boxes.forEach(function(e){var i=e.shape.x-t.shape.x,a=e.shape.y-t.shape.y,s=Math.pow(i,2),h=Math.pow(a,2),o=.5*e.sizeW+t.radius,n=.5*e.sizeH+t.radius;return s<Math.pow(o,2)&&h<Math.pow(n,2)&&(e.applyDamage(1),--t.hp<=0)?(new Ball(t.shape.x,t.shape.y,t.vx,t.vy),void t.destroy()):void 0}),this.boundWall()},e}(Ball);__reflect(BigBall.prototype,"BigBall");var ItemType;!function(t){t[t.None=0]="None",t[t.Ball=1]="Ball",t[t.Big=2]="Big",t[t.Way5=3]="Way5",t[t.Total=4]="Total"}(ItemType||(ItemType={}));var Item=function(t){function e(i,a,s){var h=t.call(this)||this;switch(e.count++,h.type=s,h.shape=new egret.Shape,h.type){case ItemType.Ball:h.radius=Util.width*BALL_SIZE_PER_WIDTH*.5*.7,h.shape.graphics.beginFill(16760832),h.shape.graphics.drawCircle(0,0,h.radius),h.shape.graphics.endFill();break;case ItemType.Big:h.radius=Util.width*BALL_SIZE_PER_WIDTH*.5*2,h.shape.graphics.lineStyle(8,16760832),h.shape.graphics.drawCircle(0,0,h.radius);break;case ItemType.Way5:var o=Util.width*BALL_SIZE_PER_WIDTH*.5;h.radius=2*o,h.shape.graphics.beginFill(16760832),h.shape.graphics.drawCircle(-2*o,.4*o,.5*o),h.shape.graphics.drawCircle(-1*o,-0*o,.5*o),h.shape.graphics.drawCircle(-0*o,-.3*o,.5*o),h.shape.graphics.drawCircle(1*o,-0*o,.5*o),h.shape.graphics.drawCircle(2*o,.4*o,.5*o),h.shape.graphics.endFill()}return GameObject.display.addChild(h.shape),h.shape.x=i,h.shape.y=a,h}return __extends(e,t),e.prototype.onDestroy=function(){e.count--},e.prototype.update=function(){this.shape.y+=Util.height/240;var t=Paddle.I.shape.x-this.shape.x,e=Paddle.I.shape.y-this.shape.y,i=.5*Paddle.I.sizeW+this.radius,a=.5*Paddle.I.sizeH+this.radius;i*i>t*t&&a*a>e*e&&(Paddle.I.pickItem(this.type),this.destroy()),this.shape.y>=Util.height&&this.destroy()},e.count=0,e}(GameObject);__reflect(Item.prototype,"Item");var Main=function(t){function e(){var e=t.call(this)||this;return e.once(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e}return __extends(e,t),e.prototype.addToStage=function(){GameObject.initial(this.stage),Util.init(this),Game.loadSceneGamePlay(),egret.startTick(this.tickLoop,this)},e.prototype.tickLoop=function(t){return GameObject.process(),!1},e}(eui.UILayer);__reflect(Main.prototype,"Main");var PadAim=function(t){function e(e,i){var a=t.call(this)||this;return a.dir=0,a.padx=e,a.pady=i,GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){return a.touchBegin(t)},a),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(t){return a.touchMove(t)},a),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_END,function(t){return a.touchEnd(t)},a),a}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){return t.touchBegin(e)},this),GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,function(e){return t.touchMove(e)},this),GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_END,function(e){return t.touchEnd(e)},this)},e.prototype.setShape=function(t,e){this.shape&&GameObject.display.removeChild(this.shape);var i=.5*Util.height,a=Paddle.I.shape.x,s=Paddle.I.shape.y-.5*Paddle.I.sizeH-BALL_SIZE_PER_WIDTH*Util.width*.5,h=t-a,o=e-s;o>0&&(o*=-1,h*=-1),this.dir=Util.clamp(Math.atan2(-h,-o),.45*-Math.PI,.45*+Math.PI),h=-Math.sin(this.dir),o=-Math.cos(this.dir),this.shape=new egret.Shape,this.shape.graphics.lineStyle(5,12632064),this.shape.graphics.moveTo(a,s),this.shape.graphics.lineTo(a+h*i,s+o*i),GameObject.display.addChild(this.shape)},e.prototype.update=function(){},e.prototype.touchBegin=function(t){this.deleteFlag||this.setShape(t.localX,t.localY)},e.prototype.touchMove=function(t){this.deleteFlag||this.setShape(t.localX,t.localY)},e.prototype.touchEnd=function(t){this.deleteFlag||(Paddle.I.shoot(this.dir),this.destroy())},e}(GameObject);__reflect(PadAim.prototype,"PadAim");var Paddle=function(t){function e(){var i=t.call(this)||this;return i.touchOffsetX=0,i.touch=!1,i.padAim=null,i.ballCount=1,i.rowCount=0,i.itemType=ItemType.None,i.state=i.stateWave,e.I=i,i.sizeW=PADDLE_SIZE_PER_WIDTH*Util.width,i.sizeH=i.sizeW*e.sizeRateH,i.setShape(.5*Util.width,.85*Util.height),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){return i.touchBegin(t)},i),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(t){return i.touchMove(t)},i),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_END,function(t){return i.touchEnd(t)},i),i}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){return t.touchBegin(e)},this),GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,function(e){return t.touchMove(e)},this),GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_END,function(e){return t.touchEnd(e)},this),e.I=null},e.prototype.setShape=function(t,e){this.shape&&GameObject.display.removeChild(this.shape),this.shape=new egret.Shape,this.shape.graphics.beginFill(7352320);var i=this.sizeW+.5*this.sizeH,a=this.sizeH;this.shape.graphics.drawRect(-.5*(i-a),-.5*a,i-a,a),this.shape.graphics.drawCircle(-.5*(i-a),0,.5*a),this.shape.graphics.drawCircle(.5*(i-a),0,.5*a),this.shape.graphics.endFill(),GameObject.display.addChild(this.shape),this.shape.x=t,this.shape.y=e},e.prototype.update=function(){this.state()},e.prototype.stateWave=function(){var t=this,e=!1;Score.I.combo=0,Box.boxes.forEach(function(i){i.shape.y+=BOX_SIZE_PER_WIDTH*Util.width*Box.sizeRateH,i.shape.y>=t.shape.y-.5*t.sizeH&&(e=!0)}),this.rowCount++;for(var i=BOX_SIZE_PER_WIDTH*Util.width,a=i*Box.sizeRateH,s=1;BOXES_IN_WIDTH>s;s++){var h=Util.randomInt(-1,this.rowCount);h>0&&new Box(i*s,1*a,Util.clamp(h,1,Box.maxHp))}e||0==this.ballCount?(this.state=this.stateAiming,new GameOver):(this.state=this.stateAiming,this.padAim=new PadAim(this.shape.x,this.shape.y-.5*this.sizeH-BALL_SIZE_PER_WIDTH*Util.width*.5))},e.prototype.stateAiming=function(){},e.prototype.shoot=function(t){this.aimDir=t;var i=-Math.sin(t),a=-Math.cos(t);this.padAim=null,this.state=this.stateCatch;var s=this.shape.x,h=this.shape.y-.5*this.sizeH-BALL_SIZE_PER_WIDTH*Util.width*.5,o=BALL_SIZE_PER_WIDTH*Util.width*.5*.5;switch(this.itemType){default:console.error("unknown item type");case ItemType.None:new Ball(s,h,i*o,a*o);break;case ItemType.Big:new BigBall(s,h,i*o,a*o);break;case ItemType.Way5:for(var n=-3;3>=n;n++){var r=t+n*Math.PI*.1;new Ball(s,h,-Math.sin(r)*o,-Math.cos(r)*o)}}for(var n=1;n<this.ballCount;n++){var p=o*(1+.2*n);new Ball(s,h,i*p,a*p)}this.itemType=ItemType.None,e.I.ballCount=0},e.prototype.stateCatch=function(){var t=this;Ball.balls.forEach(function(i){if(i.vy>0){var a=i.shape.x-t.shape.x,s=i.shape.y-t.shape.y,h=i.radius+.5*t.sizeW,o=i.radius+.5*t.sizeH;h*h>a*a&&o*o>s*s&&(e.I.ballCount++,i.destroy())}}),0==Ball.balls.length&&0==Item.count&&0==this.touch&&(this.state=this.stateWave)},e.prototype.touchBegin=function(t){this.deleteFlag||this.state!=this.stateCatch||(this.touchOffsetX=this.shape.x-t.localX,this.touch=!0)},e.prototype.touchMove=function(t){this.deleteFlag||this.state!=this.stateCatch||(this.shape.x=t.localX+this.touchOffsetX,this.shape.x=Util.clamp(this.shape.x,.5*this.sizeW,Util.width-.5*this.sizeW),this.touchOffsetX=this.shape.x-t.localX)},e.prototype.touchEnd=function(t){this.deleteFlag||this.state!=this.stateCatch||(this.touch=!1)},e.prototype.pickItem=function(t){switch(t){default:console.error("unknown type of item");case ItemType.Ball:this.ballCount++;break;case ItemType.Big:this.itemType=t;break;case ItemType.Way5:this.itemType=t}},e.I=null,e.sizeRateH=1/3,e}(GameObject);__reflect(Paddle.prototype,"Paddle");var Score=function(t){function e(){var i=t.call(this)||this;return i.point=0,i.combo=0,i.text=null,e.I=i,i.point=0,i.text=Util.newTextField("SCORE : 0",Util.width/18,16776960,.5,0,!0),GameObject.display.addChild(i.text),i}return __extends(e,t),e.prototype.onDestroy=function(){GameObject.display.removeChild(this.text),this.text=null},e.prototype.update=function(){this.text.text="SCORE : "+this.point.toFixed()},e.prototype.breakBox=function(){this.point+=1+this.combo,this.combo++},e.I=null,e}(GameObject);__reflect(Score.prototype,"Score");var Util=function(){function t(){}return t.init=function(t){this.height=t.stage.stageHeight,this.width=t.stage.stageWidth},t.random=function(t,e){return t+Math.random()*(e-t)},t.randomInt=function(t,e){return Math.floor(t+Math.random()*(e+.999-t))},t.clamp=function(t,e,i){return e>t&&(t=e),t>i&&(t=i),t},t.color=function(t,e,i){return 65536*Math.floor(255*t)+256*Math.floor(255*e)+Math.floor(255*i)},t.colorLerp=function(t,e,i){var a=1-i,s=((16711680&t)*a+(16711680&e)*i&16711680)+((65280&t)*a+(65280&e)*i&65280)+((255&t)*a+(255&e)*i&255);return s},t.newTextField=function(e,i,a,s,h,o){var n=new egret.TextField;return n.text=e,n.bold=o,n.size=i,n.textColor=a,n.x=(t.width-n.width)*s,n.y=(t.height-n.height)*h,n},t}();__reflect(Util.prototype,"Util");